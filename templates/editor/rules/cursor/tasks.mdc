---
description:
globs:
alwaysApply: true
---
---
description: Diretrizes para o agente no gerenciamento de tarefas e subtarefas no TaskManager
globs: utils/tasks.js, commands/create.js, commands/expand.js, commands/show.js
alwaysApply: true
---

# Diretrizes para Gerenciamento de Tarefas e Subtarefas

## PrincÃ­pios Gerais

- **Hierarquia de Tarefas**:
  - âœ… FAÃ‡A: Trate tarefas como unidades de trabalho autÃ´nomas
  - âœ… FAÃ‡A: Use subtarefas para decompor trabalho complexo
  - âœ… FAÃ‡A: Mantenha uma relaÃ§Ã£o clara entre tarefa principal e subtarefas
  - âŒ NÃƒO FAÃ‡A: Crie subtarefas Ã³rfÃ£s ou desconectadas da tarefa principal

  ```javascript
  // âœ… FAÃ‡A: Mantenha a hierarquia clara
  // Tarefa principal com subtarefas
  const task = {
    id: 1,
    title: "Implementar autenticaÃ§Ã£o",
    // Outros campos da tarefa
    subtasks: [
      {
        id: 1, // ID local dentro da tarefa principal
        title: "Configurar rotas de autenticaÃ§Ã£o",
        // Outros campos da subtarefa
      }
    ]
  };
  ```

## Estrutura e IdentificaÃ§Ã£o

- **Identificadores de Tarefas**:
  - âœ… FAÃ‡A: Use IDs numÃ©ricos inteiros para tarefas principais
  - âœ… FAÃ‡A: Use notaÃ§Ã£o de ponto para subtarefas (exemplo: "1.2" para subtarefa 2 da tarefa 1)
  - âœ… FAÃ‡A: Mantenha IDs sequenciais dentro de seu contexto
  - âŒ NÃƒO FAÃ‡A: Duplique IDs ou pule a sequÃªncia

  ```javascript
  // âœ… FAÃ‡A: Use identificaÃ§Ã£o adequada
  // Ao adicionar subtarefas, atribua IDs sequenciais
  const newSubtaskId = tasksData.tasks[taskIndex].subtasks.length > 0
    ? Math.max(...tasksData.tasks[taskIndex].subtasks.map(st => st.id)) + 1
    : 1;
  ```

- **Propriedades ObrigatÃ³rias**:
  - âœ… FAÃ‡A: Inclua todas as propriedades obrigatÃ³rias em tarefas e subtarefas:
    - Para tarefas: id, title, description, status, priority, dependencies, createdAt, updatedAt
    - Para subtarefas: id, title, description, status, createdAt, updatedAt
  - âœ… FAÃ‡A: Use timestamps ISO para datas
  - âŒ NÃƒO FAÃ‡A: Omita campos obrigatÃ³rios ou use formatos inconsistentes

  ```javascript
  // âœ… FAÃ‡A: Inclua todas as propriedades obrigatÃ³rias
  const newTask = {
    id: newId,
    title: taskData.title || 'Nova Tarefa',
    description: taskData.description || '',
    status: taskData.status || 'pending',
    priority: taskData.priority || defaultPriority,
    dependencies: taskData.dependencies || [],
    details: taskData.details || '',
    testStrategy: taskData.testStrategy || '',
    category: taskData.category || 'feature',
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
    subtasks: []
  };
  ```

## ManipulaÃ§Ã£o de Tarefas

- **CriaÃ§Ã£o**:
  - âœ… FAÃ‡A: Valide todos os campos obrigatÃ³rios
  - âœ… FAÃ‡A: Aplique valores padrÃ£o quando necessÃ¡rio
  - âœ… FAÃ‡A: Gere IDs Ãºnicos sequenciais
  - âŒ NÃƒO FAÃ‡A: Crie tarefas com dados parciais ou inconsistentes

  ```javascript
  // âœ… FAÃ‡A: Valide e gere IDs adequadamente
  const newId = tasksData.tasks.length > 0
    ? Math.max(...tasksData.tasks.map(t => t.id)) + 1
    : 1;
  ```

- **AtualizaÃ§Ã£o**:
  - âœ… FAÃ‡A: Atualize apenas os campos especificados
  - âœ… FAÃ‡A: Mantenha o ID inalterado
  - âœ… FAÃ‡A: Atualize o timestamp updatedAt
  - âŒ NÃƒO FAÃ‡A: Substitua toda a tarefa sem preservar campos nÃ£o modificados

  ```javascript
  // âœ… FAÃ‡A: Atualize preservando campos nÃ£o modificados
  const updatedTask = {
    ...tasksData.tasks[taskIndex],
    ...taskData,
    updatedAt: new Date().toISOString()
  };

  // Mantenha o ID original
  updatedTask.id = taskId;
  ```

- **ExclusÃ£o**:
  - âœ… FAÃ‡A: Verifique dependÃªncias antes de excluir
  - âœ… FAÃ‡A: Atualize referÃªncias apÃ³s exclusÃ£o
  - âŒ NÃƒO FAÃ‡A: Exclua tarefas sem verificar impactos

  ```javascript
  // âœ… FAÃ‡A: Verifique dependÃªncias antes de excluir
  const dependentTasks = tasksData.tasks.filter(t =>
    t.dependencies && t.dependencies.includes(taskId)
  );

  if (dependentTasks.length > 0) {
    console.log(formatWarning(`Tarefa #${taskId} nÃ£o pode ser removida pois outras tarefas dependem dela.`));
    return false;
  }
  ```

## ManipulaÃ§Ã£o de Subtarefas

- **CriaÃ§Ã£o de Subtarefas**:
  - âœ… FAÃ‡A: Verifique se a tarefa pai existe
  - âœ… FAÃ‡A: Atribua IDs sequenciais dentro do contexto da tarefa pai
  - âœ… FAÃ‡A: Inclua todos os campos obrigatÃ³rios
  - âŒ NÃƒO FAÃ‡A: Crie subtarefas para tarefas inexistentes

  ```javascript
  // âœ… FAÃ‡A: Verifique se a tarefa pai existe antes de adicionar subtarefas
  const taskIndex = tasksData.tasks.findIndex(t => t.id === taskId);
  if (taskIndex === -1) {
    return null;
  }

  // Inicialize o array de subtarefas se nÃ£o existir
  if (!tasksData.tasks[taskIndex].subtasks) {
    tasksData.tasks[taskIndex].subtasks = [];
  }
  ```

- **AtualizaÃ§Ã£o de Subtarefas**:
  - âœ… FAÃ‡A: Verifique existÃªncia da tarefa pai e da subtarefa
  - âœ… FAÃ‡A: Atualize o timestamp updatedAt da subtarefa e da tarefa pai
  - âŒ NÃƒO FAÃ‡A: Mova subtarefas entre tarefas pai diferentes

  ```javascript
  // âœ… FAÃ‡A: Atualize tarefa pai e subtarefa
  tasksData.tasks[taskIndex].subtasks[subtaskIndex].status = newStatus;
  tasksData.tasks[taskIndex].subtasks[subtaskIndex].updatedAt = now;
  tasksData.tasks[taskIndex].updatedAt = now;
  ```

- **PropagaÃ§Ã£o de Status**:
  - âœ… FAÃ‡A: Considere atualizar subtarefas quando a tarefa pai for marcada como concluÃ­da
  - âœ… FAÃ‡A: Pergunte ao usuÃ¡rio antes de propagar status
  - âŒ NÃƒO FAÃ‡A: Propague status automaticamente sem confirmaÃ§Ã£o

  ```javascript
  // âœ… FAÃ‡A: Propague status com confirmaÃ§Ã£o
  if (newStatus === 'completed' && task.subtasks && task.subtasks.length > 0) {
    const { updateSubtasks } = await inquirer.prompt([
      {
        type: 'confirm',
        name: 'updateSubtasks',
        message: 'Deseja marcar todas as subtarefas como concluÃ­das tambÃ©m?',
        default: true
      }
    ]);

    if (updateSubtasks) {
      task.subtasks = task.subtasks.map(sub => ({
        ...sub,
        status: 'completed',
        updatedAt: new Date().toISOString()
      }));
    }
  }
  ```

## ExpansÃ£o de Tarefas

- **AnÃ¡lise de Complexidade**:
  - âœ… FAÃ‡A: Analise o contexto completo da tarefa para expansÃ£o
  - âœ… FAÃ‡A: Use IA para sugerir decomposiÃ§Ã£o lÃ³gica quando disponÃ­vel
  - âœ… FAÃ‡A: Considere dependÃªncias entre subtarefas
  - âŒ NÃƒO FAÃ‡A: Divida tarefas de forma arbitrÃ¡ria ou inconsistente

  ```javascript
  // âœ… FAÃ‡A: Use anÃ¡lise da tarefa para expansÃ£o
  const taskContext = {
    title: task.title,
    description: task.description || '',
    details: task.details || '',
    category: task.category || '',
    testStrategy: task.testStrategy || '',
    existingSubtasks: task.subtasks || []
  };

  // Use IA para anÃ¡lise avanÃ§ada quando disponÃ­vel
  const analysisResult = await callPerplexityAPI(taskContext, numSubtasks);
  ```

- **Subtarefas Balanceadas**:
  - âœ… FAÃ‡A: Crie subtarefas com escopo similar
  - âœ… FAÃ‡A: Mantenha subtarefas focadas em uma Ãºnica responsabilidade
  - âœ… FAÃ‡A: Defina dependÃªncias entre subtarefas quando necessÃ¡rio
  - âŒ NÃƒO FAÃ‡A: Crie subtarefas desproporcionais ou genÃ©ricas demais
  ```javascript
  // âœ… FAÃ‡A: Defina subtarefas bem equilibradas
  const subtasksToAdd = [
    {
      title: "Configurar estrutura do banco de dados",
      description: "Criar tabelas, Ã­ndices e relacionamentos necessÃ¡rios"
    },
    {
      title: "Implementar queries de acesso",
      description: "Desenvolver funÃ§Ãµes para CRUD de dados"
    },
    {
      title: "Criar testes de integraÃ§Ã£o",
      description: "Garantir que a persistÃªncia funcione corretamente"
    }
  ];
  ```

## VisualizaÃ§Ã£o e NavegaÃ§Ã£o

- **FormataÃ§Ã£o de SaÃ­da**:
  - âœ… FAÃ‡A: Mostre claramente a hierarquia entre tarefas e subtarefas
  - âœ… FAÃ‡A: Use indentaÃ§Ã£o e formataÃ§Ã£o visual para indicar relaÃ§Ãµes
  - âœ… FAÃ‡A: Inclua indicadores de status distintos
  - âŒ NÃƒO FAÃ‡A: Apresente tarefas e subtarefas sem distinÃ§Ã£o clara

  ```javascript
  // âœ… FAÃ‡A: Formate adequadamente a exibiÃ§Ã£o
  if (task.subtasks && task.subtasks.length > 0) {
    output += `\n${chalk.bold('Subtarefas:')}\n`;
    for (const subtask of task.subtasks) {
      const statusIcon = subtask.status === 'done'
        ? chalk.green('âœ…')
        : subtask.status === 'in-progress'
          ? chalk.blue('ğŸ”„')
          : chalk.yellow('â³');

      output += `${statusIcon} ${subtask.id}. ${subtask.title}\n`;

      if (subtask.description) {
        output += `   ${chalk.gray(subtask.description)}\n`;
      }
    }
  }
  ```

- **NavegaÃ§Ã£o entre Tarefas**:
  - âœ… FAÃ‡A: Permita navegar facilmente entre tarefas e subtarefas relacionadas
  - âœ… FAÃ‡A: ForneÃ§a links ou comandos para acessar tarefas dependentes
  - âœ… FAÃ‡A: Exiba informaÃ§Ãµes de contexto relevantes
  - âŒ NÃƒO FAÃ‡A: Force o usuÃ¡rio a memorizar IDs ou relacionamentos

  ```javascript
  // âœ… FAÃ‡A: Facilite a navegaÃ§Ã£o entre tarefas
  console.log(chalk.bold.blue('\n=== COMANDOS ÃšTEIS ==='));
  console.log(`
  ${chalk.cyan('Ver tarefa principal:')}
  taskmanager show ${parentTaskId}

  ${chalk.cyan('Ver detalhes da subtarefa:')}
  taskmanager show ${taskId}.${subtaskId}

  ${chalk.cyan('Atualizar status da subtarefa:')}
  taskmanager set status ${taskId}.${subtaskId}
  `);
  ```

## ConsideraÃ§Ãµes AvanÃ§adas

- **Agrupamento e CategorizaÃ§Ã£o**:
  - âœ… FAÃ‡A: Use categorias para agrupar tarefas relacionadas
  - âœ… FAÃ‡A: Permita filtrar e visualizar por categoria
  - âŒ NÃƒO FAÃ‡A: Misture categorias inconsistentemente

  ```javascript
  // âœ… FAÃ‡A: Use categorias consistentemente
  const task = {
    // Outros campos
    category: 'backend', // Categoria da tarefa: backend, frontend, database, etc.
  };
  ```

- **DocumentaÃ§Ã£o e Contexto**:
  - âœ… FAÃ‡A: Mantenha descriÃ§Ãµes detalhadas e contextuais
  - âœ… FAÃ‡A: Inclua detalhes tÃ©cnicos e estratÃ©gias de teste
  - âœ… FAÃ‡A: Documente decisÃµes e abordagens
  - âŒ NÃƒO FAÃ‡A: Use descriÃ§Ãµes vagas ou genÃ©ricas demais

  ```javascript
  // âœ… FAÃ‡A: Inclua contexto detalhado
  const task = {
    // Outros campos
    details: "Utilizar JWT para tokens, Redis para armazenamento de sessÃ£o, e implementar refresh tokens com rotaÃ§Ã£o. Considerar proteÃ§Ã£o contra CSRF.",
    testStrategy: "Usar Jest para testes unitÃ¡rios e Supertest para testes de integraÃ§Ã£o. Cobrir casos de sucesso, falha de credenciais e expiraÃ§Ã£o de token."
  };
  ```

Consulte `utils/tasks.js`, `commands/create.js`, `commands/expand.js` e `commands/show.js` para implementaÃ§Ãµes e maiores detalhes sobre o gerenciamento de tarefas e subtarefas no TaskManager.

Acompanhe o arquivo [commands.mdc](mdc:.cursor/rules/commands.mdc) para saber mais sobre os comandos da CLI.
